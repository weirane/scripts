#!/bin/sh

# Extract URLs from stdin then copy or view it

# stdin cannot be a terminal
if [ -t 0 ]; then
    echo >&2 "stdin cannot be a terminal"
    exit
fi

selected=$(urlex -r | uniq | rofi -dmenu -i -no-custom -p 'Select a URL')

[ -z "$selected" ] && exit

case "$1" in
    -c | --copy) # copy
        echo "$selected" | xclip -selection clipboard
        ;;
    -v | --view) # view
        xdg-open "$selected"
        ;;
    *) # ask
        method=$(printf "Copy\nView\n" |
            rofi -dmenu -i -no-custom -lines 5 -p 'Action' -mesg "$selected")
        case "$method" in
            Copy)
                echo "$selected" | xclip -selection clipboard
                ;;
            View)
                xdg-open "$selected"
                ;;
        esac
        ;;
esac
